<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="NutritionDiary.Views.DiaryEntryPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ"
             BackgroundColor="#FFFBF5">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="25">

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <Frame BackgroundColor="#FF9E6D"
                   Padding="20"
                   CornerRadius="15"
                   HorizontalOptions="Fill">
                <Label x:Name="TitleLabel"
                       Text="Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center" />
            </Frame>

            <!-- ÐŸÐ¾Ð¸ÑÐº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð° -->
            <Frame BackgroundColor="White"
                   Padding="20"
                   CornerRadius="15"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#5D4037" />

                    <Frame BackgroundColor="#F8F8F8"
                           CornerRadius="12"
                           Padding="15,0"
                           HeightRequest="50"
                           HasShadow="False">
                        <Entry x:Name="ProductSearchBar"
                               Placeholder="ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°..."
                               PlaceholderColor="#D8BFD8"
                               TextColor="#5D4037"
                               BackgroundColor="Transparent"
                               FontSize="16"
                               HorizontalOptions="Fill"
                               VerticalOptions="Center" />
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² -->
            <Frame BackgroundColor="White"
                   Padding="20"
                   CornerRadius="15"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="ðŸ“‹ Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#5D4037" />

                    <ListView x:Name="ProductsListView"
                              HeightRequest="200"
                              ItemSelected="OnProductSelectedFromList"
                              HasUnevenRows="True"
                              SeparatorVisibility="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <Frame BackgroundColor="{Binding IsSelected, Converter={x:StaticResource SelectedColorConverter}}"
                                           Padding="15"
                                           CornerRadius="10"
                                           Margin="0,2"
                                           HasShadow="False">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="14" 
                                                       FontAttributes="Bold"
                                                       TextColor="{Binding IsSelected, Converter={x:StaticResource TextColorConverter}}" />
                                                <Grid ColumnDefinitions="*,*,*,*">
                                                    <Label Grid.Column="0"
                                                           Text="{Binding CaloriesPer100g, StringFormat='{0} ÐºÐºÐ°Ð»'}" 
                                                           FontSize="11" 
                                                           TextColor="{Binding IsSelected, Converter={x:StaticResource SubtextColorConverter}}" />
                                                    <Label Grid.Column="1"
                                                           Text="{Binding ProteinPer100g, StringFormat='Ð‘: {0}Ð³'}" 
                                                           FontSize="11" 
                                                           TextColor="{Binding IsSelected, Converter={x:StaticResource SubtextColorConverter}}" />
                                                    <Label Grid.Column="2"
                                                           Text="{Binding FatPer100g, StringFormat='Ð–: {0}Ð³'}" 
                                                           FontSize="11" 
                                                           TextColor="{Binding IsSelected, Converter={x:StaticResource SubtextColorConverter}}" />
                                                    <Label Grid.Column="3"
                                                           Text="{Binding CarbsPer100g, StringFormat='Ð£: {0}Ð³'}" 
                                                           FontSize="11" 
                                                           TextColor="{Binding IsSelected, Converter={x:StaticResource SubtextColorConverter}}" />
                                                </Grid>
                                            </VerticalStackLayout>

                                            <Label Grid.Column="1" 
                                                   Text="âœ…" 
                                                   FontSize="16" 
                                                   IsVisible="{Binding IsSelected}"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </Frame>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </VerticalStackLayout>
            </Frame>

            <!-- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ -->
            <Frame x:Name="SelectedProductFrame"
                   BackgroundColor="#E8F5E8"
                   Padding="20"
                   CornerRadius="15"
                   HasShadow="True"
                   IsVisible="False">
                <VerticalStackLayout Spacing="10">
                    <Label Text="âœ… Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#388E3C" />

                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label x:Name="SelectedProductName"
                                   Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°"
                                   TextColor="#388E3C"
                                   FontSize="14"
                                   FontAttributes="Bold" />
                            <Label x:Name="SelectedProductCalories"
                                   Text="0 ÐºÐºÐ°Ð»/100Ð³"
                                   FontSize="12"
                                   TextColor="#66BB6A" />
                        </VerticalStackLayout>

                        <Button Grid.Column="1"
                                Text="âœï¸"
                                BackgroundColor="Transparent"
                                TextColor="#388E3C"
                                FontSize="12"
                                HeightRequest="30"
                                WidthRequest="40"
                                CornerRadius="15"
                                Clicked="OnEditProductClicked" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¸ Ð¿Ð¸Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="15">

                <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ -->
                <Frame Grid.Column="0"
                       BackgroundColor="White"
                       Padding="20"
                       CornerRadius="15"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="âš–ï¸ ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#5D4037" />

                        <Frame BackgroundColor="#F8F8F8"
                               CornerRadius="12"
                               Padding="15,0"
                               HeightRequest="50"
                               HasShadow="False">
                            <Entry x:Name="QuantityEntry"
                                   Text="100"
                                   Keyboard="Numeric"
                                   TextColor="#5D4037"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="Center"
                                   HorizontalTextAlignment="Center" />
                        </Frame>

                        <Label Text="Ð³Ñ€Ð°Ð¼Ð¼Ñ‹"
                               FontSize="11"
                               TextColor="#8D6E63"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>

                <!-- ÐŸÐ¸Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ -->
                <Frame Grid.Column="1"
                       BackgroundColor="White"
                       Padding="20"
                       CornerRadius="15"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ðŸ“Š ÐŸÐ¸Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ" 
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#5D4037" />

                        <Grid RowDefinitions="*,*,*,*" RowSpacing="8">
                            <!-- ÐšÐ°Ð»Ð¾Ñ€Ð¸Ð¸ -->
                            <Grid Grid.Row="0" ColumnDefinitions="Auto,*">
                                <Label Grid.Column="0" 
                                       Text="ðŸ”¥" 
                                       FontSize="12"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="ÐšÐ°Ð»Ð¾Ñ€Ð¸Ð¸:"
                                       FontSize="12"
                                       TextColor="#5D4037"
                                       VerticalOptions="Center" />
                                <Label x:Name="CaloriesLabel" 
                                       Grid.Column="1"
                                       Text="0"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#FF6B35"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>

                            <!-- Ð‘ÐµÐ»ÐºÐ¸ -->
                            <Grid Grid.Row="1" ColumnDefinitions="Auto,*">
                                <Label Grid.Column="0" 
                                       Text="ðŸ¥©" 
                                       FontSize="12"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="Ð‘ÐµÐ»ÐºÐ¸:"
                                       FontSize="12"
                                       TextColor="#5D4037"
                                       VerticalOptions="Center" />
                                <Label x:Name="ProteinLabel" 
                                       Grid.Column="1"
                                       Text="0 Ð³"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#388E3C"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>

                            <!-- Ð–Ð¸Ñ€Ñ‹ -->
                            <Grid Grid.Row="2" ColumnDefinitions="Auto,*">
                                <Label Grid.Column="0" 
                                       Text="ðŸ¥‘" 
                                       FontSize="12"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="Ð–Ð¸Ñ€Ñ‹:"
                                       FontSize="12"
                                       TextColor="#5D4037"
                                       VerticalOptions="Center" />
                                <Label x:Name="FatLabel" 
                                       Grid.Column="1"
                                       Text="0 Ð³"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#F57C00"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>

                            <!-- Ð£Ð³Ð»ÐµÐ²Ð¾Ð´Ñ‹ -->
                            <Grid Grid.Row="3" ColumnDefinitions="Auto,*">
                                <Label Grid.Column="0" 
                                       Text="ðŸš" 
                                       FontSize="12"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="Ð£Ð³Ð»ÐµÐ²Ð¾Ð´Ñ‹:"
                                       FontSize="12"
                                       TextColor="#5D4037"
                                       VerticalOptions="Center" />
                                <Label x:Name="CarbsLabel" 
                                       Grid.Column="1"
                                       Text="0 Ð³"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#1976D2"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="15">

                <Button x:Name="AddCustomProductButton"
                        Grid.Column="0"
                        Text="âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚"
                        BackgroundColor="#4DB6AC"
                        TextColor="White"
                        CornerRadius="12"
                        FontSize="14"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        Clicked="OnAddCustomProductClicked" />

                <!--<Button x:Name="ScanBarcodeButton"
                        Grid.Column="1"
                        Text="ðŸ“· Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÑ‚Ñ€Ð¸Ñ…-ÐºÐ¾Ð´"
                        BackgroundColor="#FFB74D"
                        TextColor="White"
                        CornerRadius="12"
                        FontSize="14"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        Clicked="OnScanBarcodeClicked" />-->
            </Grid>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="15"
                  Margin="0,10,0,0">

                <Button Grid.Column="0"
                        Text="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
                        BackgroundColor="#FF9E6D"
                        TextColor="White"
                        CornerRadius="12"
                        FontSize="16"
                        FontAttributes="Bold"
                        HeightRequest="55"
                        Clicked="OnSaveClicked" />

                <Button Grid.Column="1"
                        Text="âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°"
                        BackgroundColor="#8D6E63"
                        TextColor="White"
                        CornerRadius="12"
                        FontSize="16"
                        FontAttributes="Bold"
                        HeightRequest="55"
                        Clicked="OnCancelClicked" />
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>